language: csharp
mono: none
dotnet: 2.2.203
dist: xenial
jobs:
  include:
  - stage: test
    script:
     - dotnet restore
     - dotnet build
     - cd "Dragon6-Test"
     - dotnet run
  - stage: pack
    script:
     - outdir="/tmp/dragon6"
     - mkdir $outdir
     - dotnet build -c Release
     - year=`date +%Y`
     - mon=`date +%m`
     - day=`date +%d`
     - dotnet pack "Dragon6-API/Dragon6-API.csproj" /p:PackageVersion=$year.$mon.$day -o $outdir -c Release 
     - dotnet nuget push $outdir/Dragon6.API.$year.$mon.$day.nupkg --api-key $nugetkey --source "https://api.nuget.org/v3/index.json"
